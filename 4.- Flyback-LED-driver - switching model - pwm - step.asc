Version 4
SHEET 1 1752 936
WIRE 144 -48 64 -48
WIRE 288 -48 144 -48
WIRE 576 -48 320 -48
WIRE 800 -48 576 -48
WIRE 1008 -48 880 -48
WIRE 1168 -48 1072 -48
WIRE 1248 -48 1168 -48
WIRE 1312 -48 1248 -48
WIRE 64 0 64 -48
WIRE 144 0 144 -48
WIRE 800 0 800 -48
WIRE 880 0 880 -48
WIRE 1312 0 1312 -48
WIRE 304 16 304 -32
WIRE 352 16 304 16
WIRE 384 16 352 16
WIRE -432 96 -496 96
WIRE -352 96 -432 96
WIRE -224 96 -320 96
WIRE -96 96 -144 96
WIRE -64 96 -96 96
WIRE 64 96 64 64
WIRE 64 96 -64 96
WIRE 1312 96 1312 64
WIRE 1168 112 1168 -48
WIRE -496 128 -496 96
WIRE -64 128 -64 96
WIRE -336 144 -336 112
WIRE -288 144 -336 144
WIRE -256 144 -288 144
WIRE 800 160 800 80
WIRE 1312 208 1312 176
WIRE -496 240 -496 208
WIRE -64 240 -64 192
WIRE -64 240 -496 240
WIRE -16 240 -64 240
WIRE 144 240 144 64
WIRE 144 240 -16 240
WIRE 528 240 464 240
WIRE 576 240 528 240
WIRE 704 240 640 240
WIRE 752 240 704 240
WIRE 64 256 64 96
WIRE 144 256 144 240
WIRE 1312 320 1312 288
WIRE 1376 336 1328 336
WIRE 1440 336 1376 336
WIRE 1600 336 1520 336
WIRE 1648 336 1600 336
WIRE 64 368 64 320
WIRE 144 368 144 320
WIRE 144 368 64 368
WIRE 608 368 608 256
WIRE 608 368 144 368
WIRE 800 368 800 256
WIRE 800 368 608 368
WIRE 880 368 880 80
WIRE 880 368 800 368
WIRE 1168 368 1168 176
WIRE 1168 368 880 368
WIRE 1312 368 1312 352
WIRE 1312 368 1168 368
WIRE 64 400 64 368
WIRE 480 496 352 496
WIRE 560 496 480 496
WIRE 560 528 560 496
WIRE 624 528 560 528
WIRE 784 544 688 544
WIRE 816 544 784 544
WIRE 624 560 560 560
WIRE 448 672 352 672
WIRE 560 672 560 560
WIRE 560 672 512 672
WIRE 432 832 352 832
WIRE 480 832 480 704
WIRE 480 832 432 832
FLAG 64 400 0
FLAG -288 144 ig
FLAG 352 16 i1
FLAG 1248 -48 out
FLAG 704 240 gate
FLAG 576 -48 in
FLAG -432 96 ac
FLAG -96 96 ac1
FLAG -16 240 ac2
FLAG 528 240 pwm
FLAG 784 544 pwm
FLAG 480 496 sw
FLAG 1376 336 id
FLAG 1600 336 id_avg
FLAG 432 832 step
SYMBOL voltage -496 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 33 86 Left 2
SYMATTR Value SINE(0 {sqrt(2)*230} 50)
SYMATTR InstName Vg
SYMBOL cap 1152 112 R0
SYMATTR InstName Co
SYMATTR Value 1.2m
SYMBOL res 1296 80 R0
SYMATTR InstName Rd
SYMATTR Value 16.4
SYMBOL voltage 1312 192 R0
WINDOW 0 44 34 Left 2
WINDOW 3 37 68 Left 2
SYMATTR InstName Vd
SYMATTR Value 63.5
SYMBOL Control\\isense -336 96 R0
SYMATTR InstName U6
SYMBOL ind2 784 -16 R0
WINDOW 0 -42 39 Left 2
WINDOW 3 -59 76 Left 2
SYMATTR InstName L1
SYMATTR Value {L1}
SYMBOL nmos 752 160 R0
WINDOW 3 -87 -11 Left 2
SYMATTR Value STP8NM60
SYMATTR InstName M1
SYMBOL Control\\driver 608 240 R0
WINDOW 3 41 41 Bottom 2
SYMATTR Value k=15
SYMATTR InstName U7
SYMBOL Control\\isense 304 -48 R0
WINDOW 0 4 -23 Bottom 2
SYMATTR InstName U9
SYMBOL diode 80 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value MUR460
SYMBOL diode 160 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -91 0 Left 2
SYMATTR InstName D3
SYMATTR Value MUR460
SYMBOL diode 80 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value MUR460
SYMBOL diode 160 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -81 -2 Left 2
SYMATTR InstName D5
SYMATTR Value MUR460
SYMBOL ind2 896 96 R180
WINDOW 0 -48 65 Left 2
WINDOW 3 -125 31 Left 2
SYMATTR InstName L2
SYMATTR Value {n**2*L1}
SYMBOL diode 1008 -32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value MUR460
SYMBOL Control\\idiode 1296 0 R0
SYMATTR InstName U1
SYMBOL ind -240 112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value 18.8m
SYMBOL cap -80 128 R0
SYMATTR InstName C1
SYMATTR Value 13.5n
SYMBOL Control\\comp 656 544 M180
SYMATTR InstName U2
SYMBOL Control\\sawtooth 320 496 R0
WINDOW 3 -4 67 Bottom 2
WINDOW 123 -6 93 Bottom 2
SYMATTR InstName U3
SYMBOL Control\\constant 320 672 R0
WINDOW 3 -3 70 Bottom 2
SYMATTR Value K={D}
SYMATTR InstName U4
SYMBOL Control\\adder2 480 672 R0
SYMATTR InstName U5
SYMBOL Control\\step 320 832 R0
WINDOW 3 -4 69 Bottom 2
WINDOW 123 2 102 Bottom 2
SYMATTR Value A=0.01
SYMATTR Value2 td=200m SR=1e8
SYMATTR InstName U8
SYMBOL Control\\isense 1312 336 M90
WINDOW 0 11 -52 VBottom 2
SYMATTR InstName U10
SYMBOL Control\\lpf 1472 336 R0
WINDOW 3 9 80 Bottom 2
WINDOW 123 0 109 Bottom 2
WINDOW 39 9 137 Bottom 2
SYMATTR Value2 wo=2*pi*10
SYMATTR InstName U11
TEXT -360 -80 Left 2 !.tran 300m uic
TEXT 8 -200 Left 2 !.param D=0.165\n.param fs=100k\n.param n=1\n.param L1=228u
TEXT 776 -80 Left 2 !k12 L1 L2 1
TEXT -360 -40 Left 2 !.options reltol=1m
